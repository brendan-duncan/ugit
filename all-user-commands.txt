Complete User Command History - ugit Development
======================================================

1. create a electron app that will eventually be a git client. use react for the gui. it will support a multiple document interface with documents contained in tabs. a document will be an opened git repo. add a menu bar with a file menu that contains an "Open Repository..." and "Exit" menu items.

2. when a repo is opened, get the list of local branches from the repo and list those in the document tab using a tree structure, splitting branch names using "/" to create the tree hierarchy. The current branch should be indicated with an icon.

3. add a console log before and after git.branchLocal to print how long that function takes

4. i don't see a devtools console when I press F12 or Ctrl+Shift+I

5. create a vertical splitter for the window with the branches panel in the top and a new stashes panel in the botton. In the stashes panel, create a list of the git stashes

6. make a third virtical split panel with the new panel at the top. this panel should have a list widget with an element, "Local Changes (#)". The # in the "Local Changes" element should be replaced with the number of files that are modified.

7. add a horizontal split with the vertical splits on the left side and a new panel on the right. This new panel will be a content viewer that changes based on what you select from the left panels. When you select the Local Changes item, the content viewer will become a local changes panel. This panel will have a vertical split, with a list of unstaged files on the top and list of staged files on the botton.

8. add a recently opened repository menu item that is persistent between program runs. Also, when the program starts, re-open the last open repos.

9. in the local changes panel, allow drag and drop between the unstaged files and the staged files area, and vise versa. when dragging from the unstagged files to the staged files, it runs git add for those files. when dragging from staged to unstaged, it runs the git command to remove them from being staged.

10. files that are staged are in the unstaged list

11. selecting a file in the local changes panel, either staged or unstaged, will open a new panel, horizontally split from the local changes panel, with a diff view of that file. this same diff view will be re-used when a different file is selected from the local changes panel.

12. when you select a stash, replace the content viewer panel to show the contents of the stash

13. for each branch in the branches panel, on the right side of the panel include a status field that shows the number of pending commits to push or can be pulled from origin. use an up arrow or down arrow next to the number to indicate push or pull.

14. don't show dev panel by default

15. add a toolbar with buttons for Fetch, Pull, Push, and Stash. Don't have them do anything yet.

16. make the repo title area take up less vertical space

17. make Local Changes a regular element and not in a list

18. implement the pull button. it should open a dialog, letting you select the branch to pull from origin, defaulting to the branch being tracked, and a checkbox for "Stash and reapply local changes". The buttons will be Pull and Cancel. Cancel will close the dialog without doing anything. Pull will do a git pull based on the dialog settings. If the checkbox is checked, the local changes will be stashed before doing the pull, and after the pull has finished, the stash will be applied. If the stash is able to be applied successfully, the stash is deleted. If not, the stash will be left. If the checkbox is not checked, the pull will be done without stashing any local changes.

19. implement the fetch button by doing a git fetch. this should call git fetch.

20. implement the push button. it should bring up a dialog with a "Branch:" selection field to select the branch to push. A "To:" selection field to select the remote origin branch to push to. A checkbox "Push all tags" when selected will push any tags that have been created. The buttons will be Push and Cancel. Push will execute the git push, and Cancel will close the dialog without doing anything.

21. In the local changes panel, in a vertical splitter panel below the staged files, add controls for committing staged files. The controls should be "Message", for the commit message, "Description" for a longer description of the commit, and a "Commit" button to run git commit. The commit button should be grayed out if there are no files in the staged area.

22. move the commit section below the stage/unstaged and diff panels so that it fills the local changes panel horizontally

23. remove the Commit label. make the description field single line by default. make the vertical height of the commit area smaller by compacting the controls, and that the commit button is visible by default. Remove the field labels and use use the field default text visual instead.

24. don't allow commit if the message is empty. and refresh the commit button state when files are dragged between staged and unstaged areas

25. cache repo data to improve load times. Add a refresh button on the toolbar as the first button to force a check that the cached data is correct, updating the data as needed. While the data is being updated, have a spinning icon on the refresh button that goes away when the load is finished.

26. cache repo data to improve load times. Add a refresh button on the toolbar as the first button to force a check that the cached data is correct, updating the data as needed. While the data is being updated, have a spinning icon on the refresh button that goes away when the load is finished.

27. switching tabs is reloading the repository data. The data should be persistent when switching tabs.

28. use thin scrollbars

29. simple-git is slow for large repos. replace simple-git with es-git

30. the package https://www.npmjs.com/package/es-git does not seem to be deprecated

31. 1

32. make a git abstraction class with implementations for simple-git, nodegit, and es-git, letting me switch witch backend to use based on a command-line argument

33. Cannot find module '../git/GitFactory'

34. cannot find module nodegit

35. add nodegit and es-git to the npm dependencies

36. in GitAdapter, move opening the repo from the constructor to an async open method

37. the data cache isn't persistent when closing and re-opening the app. store and reload the cache so that startup time is fater

38. opening the app a second time still has "Loading repository...", which is taking a long time for a large repo

39. the console has an error Cache directory not initialized. Call setCacheDir first.

40. add a console.log for every git command called, printing the git command and the time it took

41. make the staged and unstaged lists a tree structure, splitting the file paths with "/"

42. make the vertical height of the commit panel shorter

43. save the window size and position state and restore than when openeing the app again

44. add ability to drag a tree view folder between staged and unstaged panels, which will stage and unstage all files in that folder

45. after dragging elements between staged and unstaged, refresh the panels so they reflect the current information. also, while the commands for staging and unstaging files are happening, prevent other commands from happening until that is finished using a busy indicator. also, dragging a large folder is quite slow, can the stage and unstage commands be called with all of the files at once instead of individually?

46. for the items in the staging panel tree, add a context menu. the context menu items should be: "Show in File Explorer", separator, "Stage", "Discard", separator, "Stash", "Save as patch", separator, "Copy Path", "Copy Full Path".

Stage will stage all selected nodes, including folder content. Discard will call discard on all selected files. Stash will create a stash for all selected content, including folders. Save as patch will create a patch from all selected content including folders. Copy path will copy the repo relative path of the item that was clicked on to the clipboard. Copy Full Path will copy the full file path of the item that was clicked on to the clipboard.

47. right clicking on an item isn't bringing up the context menu

48. the problem is that the right click is initiating a drag. that should only be done with the left button

49. right clicking on an item in the staging tree is still initiating a drag

50. the right mouse button context menu is still not working on unstaged tree items

51. still not working. there is nothing printed to the console. right clicking on an item changes to the hand icon and starts a drag operation.

52. it's still the same behavior, right button is initiating a drag

53. same incorrect behavior

54. it's still not working, dragging behavior is blocking context menu and it's not printing anything to the console

55. i don't see the console output. can you change the build to not minimize the dist javascript so I can debug it.

56. make the cursor for file view items default, and only switch to the hand grab cursor when a drag has started. Also, don't darken the item when right clicking on the item.

57. when dragging items between staged and unstaged panels, the drop should happen for the entire panel and dropping on a tree item shouldn't have the same behavior as dropping anywhere on the panel. Dropping on the same panel should be a no-op.

58. when dragging an item from the file list, if the mouse is over a tree item it will have a crossed out arrow icon and not be droppable. the drop behavior should be for the entire panel, so tree items shouldn't block the drop.

59. there is a div parent of folder-item that has no class, which is blocking drops

60. while dragging a file list item over the panel, some items in the panel are blocking tropping the item

61. there's still something preventing drops, in the padding between elements

62. save the state of which repo tab is selected and restore it when the app is re-opened

63. For the stash list, only use the description for the label

64. for the stash list, strip off the "On <Branch>: " part of the label, so that "On 6000.0/staging: textureformatstier2" is just "textureformatstier2"

65. Remove the top repo directory and Current branch elements. Change the Changes panel to the Repo panel and change the Changes label to the repo directory and add the Current branch element under it

66. Remove the "Repo" label

67. reduce the vertical size of the repo panel so that branches gets more space

68. double clicking on a branch should switch branches

69. when pulling a branch, have a spinning busy icon next to the branch name indicating the pull is still happening, which goes away when the pull is finished

70. make the busy sign go away when the pull git command itself finishes.
instead of waiting for all rev-list commands to finish before updating the gui, update the gui as each one finishes

71. when you select a branch from the branch tree, the content panel should show the branch view panel. this should consist of two panels split vertically. the top panel is the commit list. the bottom panel is commit info for when you select a commit from the commit list. the label for items in the commit list should be on a single line, with the commit message, author name, id, and date+time.

72. don't use background color to indicate the active branch

73. make the active tab background color brighter to make it more obvious which one is active

74. in the Commit Details panel, include the list of files changed by the commit

75. make the scrollbar for the Branches list not include the Branches title, just the tree view

76. if you close a tab and then close the app, the tab will be back when re-opening the app

77. allow re-ordering of the repo tabs with drag and drop

78. implement the stash button. this should bring up a dialog that lets you set an optional Message for the stash, and a checkbox for "Stage new files", which is checked by default. If Stage new files is checked, then prior to doing the stash and new files that are unstaged and are new to the repository, are staged prior to running stash. There should be buttons for "Save stash" and "Cancel". Cancel will close and not do anything. Save stash will perform the stash, including the optional staging of new files.

79. In the Create Stash dialog, move the "Message (optional):" label to the left of the input field, change the label to "Message:", and change the input field hint to "Stash message (optional)"

80. Change the order of the buttons so "Save Stash" is first, followed by "Cancel"

81. add a tooltip to "Stage new files" that says "By default stash ignores new files until you stage them"

82. disable the stash button if there are no local changes

83. add a periodic check to see if there are new local changes. make sure this happens silently in the background and not too frequently to use too much processing

84. reduc the vertical spacing above the repo label in the ChangeList panel

85. when you select a branch, it can take some time for the commit list to come back. put a "Loading..." panel with a spinning busy icon in the content panel so that it's clear the branch info is being worked on

86. if you select a different item while a branch commit list request is still loading, cancel the  branch request and do the new item

91. improve multi-selection in the filelist views. holding shift while clicking on an item will replece the selection from the last selected item to the selected item. holding control + shift will select from the last selected item to the selected item, appending to the selection. holding control and selecting an item will toggle that items selection.

-- start using opencode here, I ran out of claude budget --

92. add a build command to build ugit as an executable

93. for every command I write here, excluding this command, append it to the text file all-user-commands.txt

94. electron recommends using electron forge for packaging an exe over electron builder. add a build command that uses force so I can try it

95. there's an error running build:force: Failed to locate module "smart-buffer" from "D:\src\ugit\node_modules\socks"

96. make the changes panel fixed height

97. reduce the vertical space used by the changes panel by removing the padding from repo-info

98. remove the padding from changes-list

99. remove the padding from repo-content

100. split-panel top-panel has a percentage height. I want that panel to be a fixed height so that resizing the window doesn't affect it.

101. undo that last change, you broke the ui

102. when dragging items between staging and unstaging, stage or unstage all selected items, not just one item

103. can the git add and reset commands be run for multiple files? if so, use a single git command for all selected files instead of individual git commands

104. remove "FileList component rendered" console log

105. in GitAdapter, consolidate add and addMultiple so that add just takes a list of files

106. handleFileDrop is called for each selected item. I want it to access list of all selected items and not be called separately for each item

107. Remove console.log lines that are prefixed with >>> to reduce log clutter

108. the push and pull buttos should update their labels with the number of commits available to push and pull for the current branch, from the same information used by the branch list from status updates. when you do a commit, it should immediately update the push button label.

109. committing files isn't updating the Push label with the new count. call status update for the active branch when doing a commit to update the labels

110. save the state of which content panel (local changes, branch, stash) was last opened and re-open that when the app starts

111. maintain the order of tabs when re-opening the app

112. select the active branch when opening the app

113. delete CliGitAdapter

114. integrate diff2html package into DiffViewer to display diffs

115. fix diff2html import error - use correct Diff2Html.html function instead of getHtmlFromDiff

116. fix diff2html color contrast - make dark red/green backgrounds with light colored text for readability

117. fix diff2html highlighted text readability - use white text for all highlighted sections to ensure readability

118. revert diff2html text color changes - the white text approach was not good

119. make diff2html red and green highlight colors darker for better contrast

120. change .diff2html-container .line-num1 color to #cfcfcf

121. overwrite the css constant d2h-del-highlight-bg-color in DiffViewer.css, make it darker than it is in Diff2Html.min.css

122. add a css rule for .d2h-code-line del to DiffViewer.css changing the background color to #79484b

123. add a css rule for .d2h-code-line ins to DiffViewer.css changing the background color to #366d35

124. overwrite .d2h-code-linenumber in DiffViewer.css and change the position to relative

125. StashViewer should use DiffViewer to view the stash diff

126. Error loading diff: ReferenceError: error is not defined at loadDiff (DiffViewer.js:36:88)

127. in commit details panel, make files changed items a tree view item. the child of the item is a diff view for that file change. the items should be collapsed by dfault, and the diff view should be loaded on demand only when the item is opened.

128. the diff2html viewer for commit detail files is empty

129. discard of a new file causes an error because it's not registered with git. new files should be deleted on discard.

130. add a Repository menu after File. It should have menu items: Refresh, separator, Fetch..., Pull..., Push..., separator, Save Stash...

131. implement refresh file menu item by calling same function as refresh toolbar button

132. implement fetch, pull, push, and stash menu items by calling the same functions as toolbar buttons

133. move main.js and index.html to src

134. npm start no longer works

135. things are still broken. revert back to before moving main.js and index.html

136. move main.js to src

137. the repository menu items aren't working

138. ReactDOM.render is no longer supported in React 18

139. the repository menu items are still not working

140. there are console errors: unable to move the cache: access is denied. unable to create cache.

141. remove the Repository menu

142. Remove Refresh, Pull, Push, Fetch, and Stash menu items from File menu

143. in the branch commit list, if a commit is not on origin, make it clear that it's not. Give it an icon, make the text italic

144. delete esgitadapter

145. display to repo origin url after the repo label in the changes panel

146. use delete hotkey for discard in local changes panel. add the hotkey to the discard item in the context menu

147. add a button to end of repo toolbar after Stash that has label "Repository" and opens a dropdown menu. The first item in dropdown menu is "Reset to origin...". Reset to origin opens a dialog that has a message "Rset local repository to origin." with buttons "Reset" and "Cancel". Cancel will close dialog and do nothing. Reset will do a hard reset to origin branch, removing all local commits.

148. instead of passing repoPath to the different panels from RepositoryView, pass gitAdapter.current, so that the panels can use that same GitAdapter

149. in RepositoryView, move the initialization of the git adapter out of loadRepoData and to the top just before initCache

150. in the file menu, add "Clone..." to the top of the menu. This should bring up a dialog with a "Clone" label, a message label that says "Clone remote repository into a local folder", a "Repository Url:" text field with a placeholder "Git Repository Url", a "Parent Folder:" text field with a file browser button next to it to select a directory, and a "Name:" text field a placeholder "Repository name". The buttons should be "Clone" and "Cancel", where Cancel closes the dialog doing nothing. Clone will do a git clone of the url to a the parent folder to a repo folder with the given name. If the copy/paste clipboard is a url string, then automatically fill the url field with that.

151. Error: Attempted to register a second handler for 'get-git-backend'

152. gitAdapter.clone is not a function. add a clone method to GitAdapter, with an implementation for SimpleGitAdapter.

153. in RepositoryView.js, gitAdapter.current is still null when git.status is called at line 300. make sure the adapter is available at the start of the repo view load, before any code that would use it is called

154. if a tab has a repoPath that doesn't exist, close tab. if a path in Recent Repositories menu doesn't exist, remove it from the recents list

155. make parent folder field of clone dialog persisent so it has the same value next time the dialog is opened, even between app runs. also, use escape as hotkey for cancel.

156. when Repository Url field value changes, update name field from url

157. when editing url field, name field should be replaced with parsed name from url

158. gitadapter clone is missing parent folder argument

159. SimpleGitAdapter clone is wrong. Change it to `const localFolder = parentFolder + "/" + repoName; const git = simpleGit(); await git.clone(repoUrl, localFolder);` so that it's cloned into the correct folder

160. rename ChangeList to RepoInfo

161. improve styling of the RepoInfo panel. Reduce margin bellow repro-branch to 8px. Remove top margin from local-changes-section. Add a changes icon before Local Changes. Remove the modified count from the repro branch and put the count in parenthesis on the local changes item.

162. put change count next to Local Changes label, change the color to off-white and bold.

163. use üìù as the local changes icon. change the local changes selection background color to #264f78. change the hover background color to #2d2d2d

164. instead of having repoinfo be in a split panel, make it have a fixed height. branches and stashes panels should be in a split panel to allow resizing between them, below of repo info.

165. handleBranchSwitch is not defined at BranchStashPanel (BranchStashPanel.js:13:27)

166. in BranchStashPanel, handleBranchSwitch should be onBranchSwitch. change RepoInfo fixed height to 160px. remove splitter-handle between RepoPanel and BranchStashPanel.

167. send all instructions that I write here (not in the application) to the existing command-logger.js so that they get logged. do not rewrite command-logger.js.

168. line 13 of BranchStashPanel.js has handleBranchSwitch. This should be onBranchSwitch.

169. in commit list of a branch, if a commit is not on origin (meaning it still needs to be pushed), highlight it with an icon and background color, making it clear that it is not on origin

170. if a repo doesn't have an origin, RepoInfo origin label should be "Origin: none"

171. in the RepoInfo, above origin, add a label "Local:" with the path to the local repo

172. on the toolbar, after Stash and before Repository, add a Branch button. this will be used to create a new branch. this will bring up a Create Branch dialog. The dialog will have a label item saying "Create branch at:" with a current branch name, and a text field with a label "Branch name:", with a placeholder "Enter branch name". Then have a checkbox "Check out after create". The buttons will be "Create" and "Cancel". Cancel, with hotkey escape, will close the dialog without doing anything. Create will create a branch using git. If the checkbox is checked, the new branch will be checked out after being created.

173. add createBranch to GitAdapter and an implementation for SimpleGitAdapter

174. in CreateBranchDialog, check the checkbox by default and make its state persistent. In RepositoryView, if checkoutAfterCreate is false, then check out the branch that was current prior to creating the branch, after the branch has been created.

175. remove createBranch from GitAdapter and SimpleGitAdapter

176. in CreateBranchDialog, make Branch name empty by default, and disable the Create button if the branch name is empty. Add a warning label below the Branch name field, which is empty, but will display a warning if the branch name already exists. If the branch name already exists, the Create button will disabled.

177. pass the current git adapter to CreateBranchDialog so it doesn't create one from the factory.

178. add createBranch to GitAdapter and SimpleGitAdapter, and have CreateBranchDialog call that to create the branch instead of checkoutBranch.

179. undo that last change, you just deleted the entire GitAdapter class!

180. add createBranch to GitAdapter

181. implement createBranch in SimpleGitAdapte

182. in RepositoryView handleCreateBranch, if checkoutAfterCreate is true and the branch is checked out, select the branch so the branch view is updated

183. when switching branches, if you have local changes, present a dialog asking what should be done with the local changes. There should be three radio buttons: Leave Alone, Stash and Reapply, Discard.

184. after stash has been reapplied in stash-and-reapply, refresh Local Change

185. if stashPop fails, don't delete the stash

186. make the LocalChangesDialog options persisent

187. In ContentViewer for stash item, selectedItem.index is undefined. It should be selectedItem.stash.index

188. don't use a background color for stash list items. when a stash list item is selected, make it look selected and remove the selection state of other items

189. there's an error on startup that selectedItem.stash is undefined when getting selectedItem.stash.index in ContentViewer.js

190. don't make the last selected item persistent. Always select the local changes item on startup.
